<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Datekeep | Liquid OS</title>

    <!-- 1. TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            prefix: 'tw-',
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#020204',
                            glass: 'rgba(255, 255, 255, 0.03)',
                            border: 'rgba(255, 255, 255, 0.08)',
                            neon: '#7c3aed', 
                            accent: '#2dd4bf',
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"SF Pro Display"', '"Inter"', 'sans-serif'],
                        mono: ['"SF Mono"', '"Fira Code"', 'monospace'],
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'pulse-glow': 'pulse-glow 3s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'liquid-pulse': 'liquid-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'pulse-glow': {
                            '0%, 100%': { opacity: 1, boxShadow: '0 0 20px rgba(124, 58, 237, 0.5)' },
                            '50%': { opacity: .8, boxShadow: '0 0 40px rgba(124, 58, 237, 0.8)' },
                        },
                        'liquid-pulse': {
                            '0%, 100%': { opacity: 1, transform: 'scale(1)' },
                            '50%': { opacity: .5, transform: 'scale(1.05)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- 2. LIBRARIES -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- LIQUID GLASS CORE --- */
        :root {
            --glass-surface: rgba(22, 22, 26, 0.6);
            --glass-highlight: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-primary: #7c3aed;
            --neon-secondary: #2dd4bf;
        }

        body {
            background-color: #000;
            color: #f3f4f6;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }

        /* Noise Texture Overlay */
        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 5;
        }

        /* Liquid Gradients */
        .liquid-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: blob 20s infinite alternate;
            z-index: 0;
        }

        /* Glass Components */
        .liquid-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(24px) saturate(120%);
            -webkit-backdrop-filter: blur(24px) saturate(120%);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .liquid-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 20px rgba(124, 58, 237, 0.1);
            border-color: rgba(255,255,255,0.2);
        }

        .liquid-input {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--glass-border);
            color: white;
            transition: 0.3s;
        }
        .liquid-input:focus {
            background: rgba(0,0,0,0.4);
            border-color: var(--neon-primary);
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.3);
            outline: none;
        }

        /* Utilities */
        .view-hidden { display: none !important; }
        ::-webkit-scrollbar { width: 0px; background: transparent; } /* Hidden scrollbar for sleekness */
        
        .timeline-spine-liquid {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, transparent, var(--neon-primary), transparent);
            z-index: 0;
            filter: drop-shadow(0 0 5px var(--neon-primary));
        }

        /* 3D Tilt Effect Base */
        .tilt-wrapper {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple-anim 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple-anim { to { transform: scale(4); opacity: 0; } }

        /* Dialog Transitions */
        dialog { background: transparent; border: none; padding: 0; margin: auto; max-width: 100vw; max-height: 100vh; }
        dialog::backdrop { background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); }
        dialog[open] { animation: floatUp 0.4s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes floatUp { from { opacity: 0; transform: translateY(40px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* Story Circle Ring */
        .story-ring {
            background: linear-gradient(to right, #7c3aed, #2dd4bf);
            padding: 2px;
            border-radius: 50%;
        }
        .story-ring-viewed {
            background: rgba(255,255,255,0.2);
            padding: 2px;
            border-radius: 50%;
        }
    </style>
</head>
<body class="tw-h-screen tw-flex tw-flex-col tw-text-gray-100 tw-overflow-hidden" onclick="createRipple(event)">

    <div class="noise-overlay"></div>

    <!-- BACKGROUND BLOBS -->
    <div class="liquid-blob tw-bg-purple-600 tw-top-[-10%] tw-left-[-10%] tw-w-[50vw] tw-h-[50vw]"></div>
    <div class="liquid-blob tw-bg-teal-600 tw-bottom-[-10%] tw-right-[-10%] tw-w-[50vw] tw-h-[50vw]" style="animation-delay: -5s"></div>
    <div class="liquid-blob tw-bg-blue-600 tw-top-[40%] tw-left-[30%] tw-w-[30vw] tw-h-[30vw]" style="animation-delay: -10s"></div>

    <!-- TOASTS -->
    <div id="toast-container" class="tw-fixed tw-top-8 tw-left-1/2 tw--translate-x-1/2 tw-z-[100] tw-flex tw-flex-col tw-gap-3 tw-pointer-events-none tw-w-full tw-max-w-xs"></div>

    <!-- VIEW 1: PREMIUM LOCK SCREEN -->
    <div id="auth-view" class="tw-fixed tw-inset-0 tw-z-50 tw-flex tw-flex-col tw-items-center tw-justify-center tw-backdrop-blur-[40px] tw-bg-black/40">
        <div class="liquid-card tw-p-10 tw-rounded-[3.5rem] tw-w-full tw-max-w-[340px] tw-text-center tw-relative tw-overflow-hidden tw-border tw-border-white/10 tw-shadow-[0_20px_60px_-15px_rgba(0,0,0,0.5)]">
            
            <!-- Shimmer Overlay -->
            <div class="tw-absolute tw-inset-0 tw-bg-gradient-to-tr tw-from-transparent tw-via-white/5 tw-to-transparent tw-opacity-30 tw-pointer-events-none"></div>

            <!-- Premium Biometric Visual -->
            <div class="tw-relative tw-w-28 tw-h-28 tw-mx-auto tw-mb-10 tw-cursor-pointer group" onclick="app.triggerBiometric()">
                <!-- Outer Breathing Ring -->
                <div class="tw-absolute tw-inset-0 tw-rounded-full tw-border tw-border-cyber-neon/40 tw-animate-liquid-pulse"></div>
                <!-- Inner Spinning Rings -->
                <div class="tw-absolute tw-inset-2 tw-rounded-full tw-border-t-2 tw-border-r-2 tw-border-cyber-neon/60 tw-animate-[spin_4s_linear_infinite]"></div>
                <div class="tw-absolute tw-inset-4 tw-rounded-full tw-border-b-2 tw-border-l-2 tw-border-cyber-accent/60 tw-animate-[spin_3s_linear_infinite_reverse]"></div>
                
                <!-- Fingerprint Icon -->
                <div class="tw-absolute tw-inset-0 tw-flex tw-items-center tw-justify-center tw-z-10">
                    <i data-lucide="fingerprint" class="tw-w-12 tw-h-12 tw-text-white/90 tw-transition-all tw-duration-500 group-hover:tw-text-cyber-neon group-hover:tw-scale-110 group-hover:tw-drop-shadow-[0_0_15px_rgba(124,58,237,0.8)]"></i>
                </div>
                
                <!-- Glow -->
                <div class="tw-absolute tw-inset-0 tw-bg-cyber-neon/10 tw-rounded-full tw-blur-2xl tw-opacity-0 group-hover:tw-opacity-100 tw-transition-opacity tw-duration-700"></div>
            </div>

            <h1 class="tw-text-4xl tw-font-black tw-mb-2 tw-tracking-tight tw-text-white drop-shadow-md">Datekeep</h1>
            <p class="tw-text-[10px] tw-text-gray-400 tw-mb-10 tw-uppercase tw-tracking-[0.3em] tw-font-medium">Shared Neural Vault</p>

            <!-- PIN Pad -->
            <div class="tw-flex tw-justify-center tw-gap-4 tw-mb-10">
                <div class="pin-dot tw-w-3 tw-h-3 tw-rounded-full tw-bg-white/10 tw-transition-all"></div>
                <div class="pin-dot tw-w-3 tw-h-3 tw-rounded-full tw-bg-white/10 tw-transition-all"></div>
                <div class="pin-dot tw-w-3 tw-h-3 tw-rounded-full tw-bg-white/10 tw-transition-all"></div>
                <div class="pin-dot tw-w-3 tw-h-3 tw-rounded-full tw-bg-white/10 tw-transition-all"></div>
            </div>

            <div class="tw-grid tw-grid-cols-3 tw-gap-4">
                <!-- Keys generated dynamically or manual -->
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="1">1</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="2">2</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="3">3</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="4">4</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="5">5</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="6">6</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="7">7</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="8">8</button>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="9">9</button>
                <div class="tw-opacity-0"></div>
                <button class="pin-btn tw-h-14 tw-rounded-2xl tw-bg-white/5 hover:tw-bg-white/15 hover:tw-scale-105 tw-active:scale-95 tw-transition-all tw-text-xl tw-font-medium" data-val="0">0</button>
                <button id="pin-clear" class="tw-h-14 tw-rounded-2xl tw-text-red-400 hover:tw-bg-red-500/10 hover:tw-scale-105 tw-active:scale-95 tw-flex tw-items-center tw-justify-center tw-transition-all"><i data-lucide="delete"></i></button>
            </div>
            
            <p id="auth-error" class="tw-absolute tw-bottom-6 tw-left-0 tw-w-full tw-text-xs tw-text-red-400 tw-font-mono tw-opacity-0 tw-transition-opacity tw-tracking-widest">ACCESS DENIED</p>
            
            <div class="tw-mt-6 tw-text-[10px] tw-text-gray-500 tw-font-mono">
                PIN: 1111 (Chalak Lomdi) / 2222 (Bhondu Bhalu)
            </div>
        </div>
    </div>

    <!-- VIEW 2: DASHBOARD -->
    <div id="dashboard-view" class="view-hidden tw-flex-1 tw-flex tw-flex-col tw-relative tw-h-full">
        
        <!-- Glass Header -->
        <header class="tw-absolute tw-top-0 tw-w-full tw-z-40 tw-px-6 tw-py-4 tw-flex tw-items-center tw-justify-between tw-backdrop-blur-md tw-border-b tw-border-white/5">
            <div class="tw-flex tw-items-center tw-gap-4">
                <div class="tw-relative">
                    <div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-gradient-to-tr tw-from-cyber-neon tw-to-blue-500 tw-flex tw-items-center tw-justify-center tw-text-white tw-font-bold tw-shadow-lg tw-cursor-pointer" id="avatar-btn" onclick="app.signOut()">
                        <span id="user-initial">U</span>
                    </div>
                    <div class="tw-absolute tw-bottom-0 tw-right-0 tw-w-3 tw-h-3 tw-bg-green-500 tw-rounded-full tw-border-2 tw-border-black tw-animate-pulse"></div>
                </div>
                <div>
                    <h2 class="tw-text-sm tw-font-bold tw-text-white" id="greeting-text">Welcome Back</h2>
                    <div class="tw-flex tw-items-center tw-gap-2">
                        <i data-lucide="cloud-sun" class="tw-w-3 tw-h-3 tw-text-yellow-400"></i>
                        <span class="tw-text-[10px] tw-text-gray-400">Liquid Sync Active</span>
                    </div>
                </div>
            </div>
            
            <div class="tw-flex tw-gap-3">
                <button class="tw-p-2 tw-rounded-full tw-bg-white/5 hover:tw-bg-white/10 tw-transition-all" onclick="app.toggleSound()" id="sound-btn">
                    <i data-lucide="waves" class="tw-w-5 tw-h-5 tw-text-gray-400"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="tw-flex-1 tw-overflow-y-auto tw-pt-24 tw-pb-24 tw-px-4 custom-scrollbar">
            <div class="tw-max-w-3xl tw-mx-auto">
                
                <!-- FLUX STATUS (STORIES) -->
                <div class="tw-mb-8">
                    <div class="tw-flex tw-gap-4 tw-overflow-x-auto no-scrollbar tw-py-2" id="stories-container">
                        <!-- Add Story Button -->
                        <div class="tw-flex tw-flex-col tw-items-center tw-gap-2 tw-flex-shrink-0 tw-cursor-pointer" onclick="app.openAddModal('status')">
                            <div class="tw-w-16 tw-h-16 tw-rounded-full tw-border-2 tw-border-dashed tw-border-white/30 tw-flex tw-items-center tw-justify-center hover:tw-bg-white/5 tw-transition-all">
                                <i data-lucide="plus" class="tw-w-6 tw-h-6 tw-text-cyber-neon"></i>
                            </div>
                            <span class="tw-text-[10px] tw-text-gray-400">Add Flux</span>
                        </div>
                        <!-- Dynamic Stories will be injected here -->
                    </div>
                </div>

                <!-- Stats Rings -->
                <div class="tw-grid tw-grid-cols-2 md:tw-grid-cols-4 tw-gap-4 tw-mb-8">
                    <div class="liquid-card tw-p-4 tw-rounded-3xl tw-flex tw-items-center tw-gap-4 tw-relative tw-overflow-hidden">
                        <div class="tw-w-12 tw-h-12 tw-rounded-full tw-border-4 tw-border-cyber-neon/30 tw-flex tw-items-center tw-justify-center">
                            <i data-lucide="layers" class="tw-w-5 tw-h-5 tw-text-cyber-neon"></i>
                        </div>
                        <div>
                            <div class="tw-text-2xl tw-font-bold" id="stat-total">0</div>
                            <div class="tw-text-[10px] tw-uppercase tw-tracking-wider tw-text-gray-400">Hive Memory</div>
                        </div>
                    </div>
                    <div class="liquid-card tw-p-4 tw-rounded-3xl tw-flex tw-items-center tw-gap-4">
                        <div class="tw-w-12 tw-h-12 tw-rounded-full tw-border-4 tw-border-cyber-accent/30 tw-flex tw-items-center tw-justify-center">
                             <i data-lucide="activity" class="tw-w-5 tw-h-5 tw-text-cyber-accent"></i>
                        </div>
                        <div>
                            <div class="tw-text-2xl tw-font-bold" id="stat-streak">0</div>
                            <div class="tw-text-[10px] tw-uppercase tw-tracking-wider tw-text-gray-400">Sync Streak</div>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div class="tw-relative tw-mb-8 tw-group">
                    <div class="liquid-card tw-rounded-2xl tw-flex tw-items-center tw-px-4 tw-py-3 tw-relative">
                        <i data-lucide="search" class="tw-w-5 tw-h-5 tw-text-gray-400 tw-mr-3"></i>
                        <input type="text" id="search-input" placeholder="Search the shared mind..." class="tw-bg-transparent tw-border-none tw-outline-none tw-text-white tw-w-full tw-placeholder-gray-600">
                    </div>
                </div>

                <!-- Timeline -->
                <div class="tw-relative tw-min-h-[300px]">
                    <div class="timeline-spine-liquid"></div>
                    <div id="timeline-container" class="tw-space-y-8 tw-perspective-1000">
                        <!-- Items injected here -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="empty-state" class="tw-hidden tw-text-center tw-py-20">
                        <div class="liquid-blob tw-relative tw-mx-auto tw-w-32 tw-h-32 tw-bg-white/5 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mb-4">
                            <i data-lucide="wind" class="tw-w-12 tw-h-12 tw-text-gray-600"></i>
                        </div>
                        <p class="tw-text-gray-500">The hive is silent.</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Morphing FAB -->
        <button onclick="app.openAddModal('memory')" class="tw-fixed tw-bottom-8 tw-right-6 tw-w-16 tw-h-16 tw-bg-gradient-to-tr tw-from-cyber-neon tw-to-blue-600 tw-rounded-[1.5rem] tw-flex tw-items-center tw-justify-center tw-shadow-[0_0_30px_rgba(124,58,237,0.5)] hover:tw-shadow-[0_0_50px_rgba(124,58,237,0.8)] hover:tw-scale-110 hover:tw-rotate-90 tw-transition-all tw-duration-300 tw-z-50 group">
            <i data-lucide="plus" class="tw-w-8 tw-h-8 tw-text-white"></i>
        </button>
    </div>

    <!-- DIALOG: EDITOR -->
    <dialog id="entry-dialog" class="tw-bg-transparent tw-w-full md:tw-max-w-2xl tw-fixed tw-bottom-0 md:tw-top-1/2 md:tw-left-1/2 md:tw--translate-x-1/2 md:tw--translate-y-1/2 tw-m-0">
        <div class="liquid-card tw-rounded-t-[2.5rem] md:tw-rounded-[2.5rem] tw-w-full tw-h-[90vh] md:tw-h-auto md:tw-max-h-[85vh] tw-flex tw-flex-col tw-overflow-hidden tw-border-b-0">
            <form id="entry-form" class="tw-flex tw-flex-col tw-h-full">
                <input type="hidden" name="id" id="entry-id">
                <input type="hidden" name="type" id="entry-type" value="memory">
                
                <!-- Handle -->
                <div class="tw-w-12 tw-h-1 tw-bg-white/20 tw-rounded-full tw-mx-auto tw-mt-4 md:tw-hidden"></div>

                <!-- Header -->
                <div class="tw-px-8 tw-pt-6 tw-pb-4 tw-flex tw-justify-between tw-items-center">
                    <div>
                        <h2 class="tw-text-2xl tw-font-bold tw-text-white" id="dialog-title">New Entry</h2>
                        <p class="tw-text-xs tw-text-cyber-accent tw-uppercase tw-tracking-wider" id="dialog-subtitle">Shared with everyone</p>
                    </div>
                    <button type="button" onclick="app.closeDialog()" class="tw-p-2 tw-rounded-full hover:tw-bg-white/10"><i data-lucide="x"></i></button>
                </div>

                <!-- Body -->
                <div class="tw-flex-1 tw-overflow-y-auto tw-px-8 tw-py-2 custom-scrollbar">
                    
                    <div id="memory-fields">
                        <input type="text" name="title" id="inp-title" placeholder="Title your memory..." 
                            class="tw-w-full tw-bg-transparent tw-border-none tw-text-3xl tw-font-bold tw-text-white tw-placeholder-gray-700 focus:tw-outline-none tw-mb-6">

                        <div class="tw-flex tw-gap-4 tw-mb-6 tw-overflow-x-auto no-scrollbar">
                            <div class="liquid-input tw-rounded-2xl tw-px-4 tw-py-2 tw-flex tw-items-center tw-gap-2 tw-min-w-[140px]">
                                <i data-lucide="calendar" class="tw-w-4 tw-h-4 tw-text-gray-400"></i>
                                <input type="date" name="date" class="tw-bg-transparent tw-border-none tw-text-sm tw-text-white focus:tw-outline-none tw-w-full">
                            </div>
                            <div class="liquid-input tw-rounded-2xl tw-px-4 tw-py-2 tw-flex tw-items-center tw-gap-2 tw-min-w-[120px]">
                                <i data-lucide="clock" class="tw-w-4 tw-h-4 tw-text-gray-400"></i>
                                <input type="time" name="time" class="tw-bg-transparent tw-border-none tw-text-sm tw-text-white focus:tw-outline-none tw-w-full">
                            </div>
                        </div>

                        <div class="tw-mb-6">
                            <label class="tw-text-xs tw-text-gray-500 tw-uppercase tw-tracking-widest tw-mb-3 tw-block">Vibe</label>
                            <div class="tw-flex tw-gap-4 tw-items-center">
                                <div class="tw-flex tw-gap-2">
                                    <label class="tw-cursor-pointer group"><input type="radio" name="category" value="briefcase" class="tw-peer tw-hidden" checked><div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-white/5 tw-flex tw-items-center tw-justify-center tw-border tw-border-transparent peer-checked:tw-bg-blue-500 tw-transition-all"><i data-lucide="briefcase" class="tw-w-4 tw-h-4"></i></div></label>
                                    <label class="tw-cursor-pointer group"><input type="radio" name="category" value="heart" class="tw-peer tw-hidden"><div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-white/5 tw-flex tw-items-center tw-justify-center tw-border tw-border-transparent peer-checked:tw-bg-pink-500 tw-transition-all"><i data-lucide="heart" class="tw-w-4 tw-h-4"></i></div></label>
                                    <label class="tw-cursor-pointer group"><input type="radio" name="category" value="plane" class="tw-peer tw-hidden"><div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-white/5 tw-flex tw-items-center tw-justify-center tw-border tw-border-transparent peer-checked:tw-bg-teal-500 tw-transition-all"><i data-lucide="plane" class="tw-w-4 tw-h-4"></i></div></label>
                                </div>
                                <div class="tw-w-[1px] tw-h-8 tw-bg-white/10"></div>
                                <div class="tw-flex-1">
                                    <input type="range" name="mood" min="1" max="5" value="3" class="tw-w-full tw-h-1 tw-bg-gray-700 tw-rounded-lg tw-appearance-none cursor-pointer tw-accent-cyber-neon">
                                </div>
                            </div>
                        </div>

                        <div class="liquid-input tw-rounded-3xl tw-p-4 tw-mb-4 tw-relative tw-group focus-within:tw-border-cyber-neon">
                            <textarea name="notes" id="inp-notes" rows="4" placeholder="Write something..." class="tw-w-full tw-bg-transparent tw-border-none tw-outline-none tw-text-gray-200 tw-resize-none tw-leading-relaxed"></textarea>
                        </div>
                    </div>

                    <!-- Image Upload (Used for both Memory and Status) -->
                    <div id="drop-zone" class="tw-border-2 tw-border-dashed tw-border-white/10 tw-rounded-3xl tw-p-6 tw-text-center hover:tw-bg-white/5 hover:tw-border-cyber-neon/50 tw-transition-all tw-cursor-pointer" onclick="document.getElementById('img-input').click()">
                        <div id="upload-placeholder">
                            <div class="tw-w-10 tw-h-10 tw-rounded-full tw-bg-white/5 tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-2">
                                <i data-lucide="image-plus" class="tw-w-5 tw-h-5 tw-text-gray-400"></i>
                            </div>
                            <span class="tw-text-xs tw-text-gray-500">Tap to upload visuals</span>
                        </div>
                        <div id="img-preview-box" class="tw-hidden tw-relative tw-inline-block">
                            <img id="img-preview" class="tw-max-h-40 tw-rounded-2xl tw-shadow-lg">
                            <button type="button" onclick="app.clearImage(event)" class="tw-absolute -tw-top-2 -tw-right-2 tw-bg-red-500 tw-text-white tw-rounded-full tw-p-1.5 hover:tw-scale-110"><i data-lucide="x" class="tw-w-3 tw-h-3"></i></button>
                        </div>
                    </div>
                    <input type="file" id="img-input" accept="image/*" class="tw-hidden">
                    <input type="hidden" name="imageData" id="inp-image">

                </div>

                <!-- Footer -->
                <div class="tw-p-6 tw-border-t tw-border-white/5 tw-bg-black/20 tw-backdrop-blur-md">
                    <button type="button" onclick="app.saveEntry()" class="tw-w-full tw-py-4 tw-rounded-2xl tw-bg-gradient-to-r tw-from-cyber-neon tw-to-blue-600 tw-text-white tw-font-bold tw-text-lg tw-shadow-[0_0_20px_rgba(124,58,237,0.4)] hover:tw-shadow-[0_0_30px_rgba(124,58,237,0.6)] hover:tw-scale-[1.02] tw-transition-all">Publish to Hive</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- LIGHTBOX -->
    <div id="lightbox" class="tw-fixed tw-inset-0 tw-z-[100] tw-bg-black/95 tw-backdrop-blur-xl tw-flex tw-items-center tw-justify-center tw-opacity-0 tw-pointer-events-none tw-transition-all tw-duration-300">
        <img id="lightbox-img" class="tw-max-w-[95vw] tw-max-h-[85vh] tw-rounded-2xl tw-shadow-2xl tw-scale-90 tw-transition-transform tw-duration-300">
        <button onclick="app.downloadImage()" class="tw-absolute tw-bottom-10 tw-p-4 tw-bg-white/10 tw-rounded-full tw-backdrop-blur-md hover:tw-bg-white/20 tw-text-white tw-transition-all">
            <i data-lucide="download" class="tw-w-6 tw-h-6"></i>
        </button>
        <button onclick="app.closeLightbox()" class="tw-absolute tw-top-10 tw-right-10 tw-p-4 tw-text-white/50 hover:tw-text-white">
            <i data-lucide="x" class="tw-w-8 tw-h-8"></i>
        </button>
    </div>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyD1efcO8mx7hkuwgSRU7B1625chEqWI8kY", authDomain: "gatekeep-001.firebaseapp.com", projectId: "gatekeep-001", storageBucket: "gatekeep-001.firebasestorage.app", messagingSenderId: "771094597260", appId: "1:771094597260:web:557a6401ab7fa71f5175a9" };
        let db; try { db = getFirestore(initializeApp(firebaseConfig)); } catch(e) {}

        const state = {
            currentUser: null,
            pin: [],
            data: [], // Shared memories
            statuses: [], // Shared 24h statuses
            filter: 'all',
            pinAttempts: 0,
            moods: ['Angry', 'Sad', 'Neutral', 'Good', 'Euphoric'],
            soundOn: false
        };

        // --- UPDATED USERNAMES ---
        const VALID_PINS = { 
            '1111': { name: 'Chalak Lomdi', uid: 'u_1111' }, 
            '2222': { name: 'Bhondu Bhalu', uid: 'u_2222' } 
        };

        const els = {
            authView: document.getElementById('auth-view'),
            dashboardView: document.getElementById('dashboard-view'),
            container: document.getElementById('timeline-container'),
            storiesContainer: document.getElementById('stories-container'),
            dialog: document.getElementById('entry-dialog'),
            searchInput: document.getElementById('search-input'),
            lightbox: document.getElementById('lightbox'),
            lightboxImg: document.getElementById('lightbox-img')
        };

        // --- AUTH ---
        document.querySelectorAll('.pin-btn').forEach(btn => btn.addEventListener('click', () => handlePin(btn.dataset.val)));
        document.getElementById('pin-clear').addEventListener('click', () => { state.pin = []; updatePinUI(); });
        document.addEventListener('keydown', (e) => {
            if(!els.authView.classList.contains('tw-hidden')) {
                if(e.key >= '0' && e.key <= '9') handlePin(e.key);
                if(e.key === 'Backspace') { state.pin.pop(); updatePinUI(); }
            }
        });

        function handlePin(val) {
            if(state.pin.length < 4) {
                state.pin.push(val);
                updatePinUI();
                if(state.pin.length === 4) verifyPin();
            }
        }

        function updatePinUI() {
            document.querySelectorAll('.pin-dot').forEach((dot, i) => {
                dot.classList.toggle('tw-bg-cyber-neon', i < state.pin.length);
                dot.classList.toggle('tw-shadow-[0_0_15px_#7c3aed]', i < state.pin.length);
            });
        }

        function verifyPin() {
            const pin = state.pin.join('');
            if(VALID_PINS[pin]) {
                state.currentUser = VALID_PINS[pin];
                els.authView.classList.add('tw-hidden');
                els.dashboardView.classList.remove('view-hidden');
                
                const hr = new Date().getHours();
                const greet = hr < 12 ? "Good Morning" : hr < 18 ? "Good Afternoon" : "Good Evening";
                document.getElementById('greeting-text').innerText = `${greet}, ${state.currentUser.name.split(' ')[0]}`;
                document.getElementById('user-initial').innerText = state.currentUser.name[0];
                
                initData();
            } else {
                state.pin = []; updatePinUI();
                const err = document.getElementById('auth-error');
                err.style.opacity = '1';
                setTimeout(() => err.style.opacity = '0', 2000);
            }
        }

        // --- DATA LAYER (SHARED) ---
        // We use a fixed collection 'shared_timeline_v1' so both users see the same data
        function getSharedCollection() {
            return collection(db, 'artifacts', 'gatekeep-001', 'public', 'data', 'shared_timeline_v1');
        }

        function initData() {
            if(db) {
                const q = query(getSharedCollection(), orderBy('createdAt', 'desc'));
                onSnapshot(q, snap => {
                    const raw = snap.docs.map(d => ({id:d.id, ...d.data()}));
                    
                    // Split into Memories and Statuses
                    const now = Date.now();
                    state.data = raw.filter(d => d.type === 'memory' || !d.type); // Default to memory
                    state.statuses = raw.filter(d => d.type === 'status' && d.expiresAt > now);
                    
                    renderTimeline();
                    renderStories();
                    updateStats();
                });
            } else {
                // Local Fallback
                const raw = JSON.parse(localStorage.getItem('dk_shared_v1') || '[]');
                const now = Date.now();
                state.data = raw.filter(d => d.type === 'memory' || !d.type);
                state.statuses = raw.filter(d => d.type === 'status' && d.expiresAt > now);
                renderTimeline();
                renderStories();
                updateStats();
            }
        }

        // --- RENDER STORIES (24h Flux) ---
        function renderStories() {
            // Keep the "Add" button
            const addBtn = els.storiesContainer.firstElementChild;
            els.storiesContainer.innerHTML = '';
            els.storiesContainer.appendChild(addBtn);

            state.statuses.forEach(status => {
                const bubble = document.createElement('div');
                bubble.className = "tw-flex tw-flex-col tw-items-center tw-gap-2 tw-flex-shrink-0 tw-cursor-pointer tw-animate-[float_6s_ease-in-out_infinite]";
                bubble.onclick = () => app.viewStatus(status);
                
                // Color ring based on user
                const ringColor = status.author === 'Chalak Lomdi' ? 'tw-from-cyber-neon tw-to-blue-500' : 'tw-from-pink-500 tw-to-orange-500';
                
                bubble.innerHTML = `
                    <div class="tw-w-16 tw-h-16 tw-rounded-full tw-p-[2px] tw-bg-gradient-to-tr ${ringColor}">
                        <div class="tw-w-full tw-h-full tw-rounded-full tw-bg-black tw-border-2 tw-border-transparent tw-overflow-hidden">
                            ${status.imageData ? `<img src="${status.imageData}" class="tw-w-full tw-h-full tw-object-cover">` : `<div class="tw-w-full tw-h-full tw-bg-white/10 tw-flex tw-items-center tw-justify-center text-xs">${status.author[0]}</div>`}
                        </div>
                    </div>
                    <span class="tw-text-[10px] tw-text-gray-400">${status.author}</span>
                `;
                els.storiesContainer.appendChild(bubble);
            });
        }

        // --- RENDER TIMELINE ---
        function renderTimeline() {
            els.container.innerHTML = '';
            const term = els.searchInput.value.toLowerCase();
            
            const filtered = state.data.filter(d => {
                const matchesTerm = (d.title||'').toLowerCase().includes(term) || (d.notes||'').toLowerCase().includes(term);
                return matchesTerm;
            });

            if(filtered.length === 0) document.getElementById('empty-state').classList.remove('tw-hidden');
            else document.getElementById('empty-state').classList.add('tw-hidden');

            filtered.forEach((item, idx) => {
                const date = new Date(item.date || item.createdAt);
                const isMe = item.author === state.currentUser.name;
                const moodColor = getMoodColor(item.mood || 3);
                const comments = item.comments || [];

                const card = document.createElement('div');
                card.className = "liquid-card tw-rounded-3xl tw-p-5 tw-relative tilt-wrapper tw-cursor-pointer tw-ml-4 tw-mb-6 slide-up";
                card.style.animationDelay = `${idx * 0.05}s`;
                card.style.borderLeft = `3px solid ${moodColor}`;
                
                // 3D Tilt
                card.onmousemove = (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    card.style.transform = `perspective(1000px) rotateX(${(y - rect.height/2)/20}deg) rotateY(${-(x - rect.width/2)/20}deg) scale(1.02)`;
                };
                card.onmouseleave = () => card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';

                let imgHtml = item.imageData ? `
                    <div class="tw-relative tw-group">
                        <img src="${item.imageData}" class="tw-w-full tw-h-48 tw-object-cover tw-rounded-2xl tw-mb-4 tw-shadow-lg" onclick="app.lightbox('${item.imageData}')">
                        <button class="tw-absolute tw-bottom-2 tw-right-2 tw-p-2 tw-bg-black/50 tw-rounded-full tw-backdrop-blur tw-opacity-0 group-hover:tw-opacity-100 tw-transition-opacity" onclick="event.stopPropagation(); app.downloadImage('${item.imageData}')">
                            <i data-lucide="download" class="tw-w-4 tw-h-4 tw-text-white"></i>
                        </button>
                    </div>` : '';

                // Comments HTML
                const commentsHtml = comments.map(c => `
                    <div class="tw-flex tw-gap-2 tw-mb-2 tw-text-xs">
                        <span class="tw-font-bold ${c.author === 'Chalak Lomdi' ? 'tw-text-blue-400' : 'tw-text-pink-400'}">${c.author}:</span>
                        <span class="tw-text-gray-300">${c.text}</span>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="tw-absolute -tw-left-[29px] tw-top-6 tw-w-4 tw-h-4 tw-rounded-full tw-bg-[#020204] tw-border-2 tw-border-cyber-neon tw-z-10 tw-shadow-[0_0_10px_#7c3aed]"></div>
                    
                    <div class="tw-flex tw-justify-between tw-items-start tw-mb-3">
                        <div>
                            <div class="tw-flex tw-items-center tw-gap-2">
                                <span class="tw-text-xs tw-font-bold tw-text-cyber-accent tw-uppercase tw-tracking-widest">${item.author || 'Unknown'}</span>
                                <span class="tw-text-[10px] tw-text-gray-500">${new Date(item.createdAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                            </div>
                            <h3 class="tw-font-bold tw-text-lg tw-text-white tw-mt-1">${item.title}</h3>
                        </div>
                        <div class="tw-p-2 tw-rounded-full tw-bg-white/5" title="Mood">
                            <div class="tw-w-3 tw-h-3 tw-rounded-full" style="background:${moodColor}; box-shadow: 0 0 10px ${moodColor}"></div>
                        </div>
                    </div>

                    ${imgHtml}

                    <div class="md-content tw-text-sm tw-text-gray-300 tw-line-clamp-3 tw-mb-4">
                        ${DOMPurify.sanitize(marked.parse(item.notes || ''))}
                    </div>

                    <!-- Comments Section -->
                    <div class="tw-bg-black/20 tw-rounded-xl tw-p-3 tw-mb-3 ${comments.length ? '' : 'tw-hidden'}" id="comments-${item.id}">
                        ${commentsHtml}
                    </div>

                    <div class="tw-flex tw-justify-between tw-items-center tw-border-t tw-border-white/5 tw-pt-3">
                        <div class="tw-flex tw-gap-2">
                            <input type="text" placeholder="Add comment..." class="tw-bg-transparent tw-text-xs tw-text-white focus:tw-outline-none tw-w-32" 
                                onkeydown="if(event.key==='Enter'){app.addComment('${item.id}', this.value); this.value='';}" onclick="event.stopPropagation()">
                        </div>
                        <div class="tw-flex tw-gap-3">
                            <button onclick="event.stopPropagation(); app.deleteEntry('${item.id}')" class="tw-text-gray-600 hover:tw-text-red-400"><i data-lucide="trash-2" class="tw-w-4 tw-h-4"></i></button>
                        </div>
                    </div>
                `;
                els.container.appendChild(card);
            });
            lucide.createIcons();
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = state.data.length;
            const dates = [...new Set(state.data.map(d => d.date))];
            document.getElementById('stat-streak').innerText = dates.length;
        }

        // --- APP ACTIONS ---
        window.app = {
            triggerBiometric: () => {
                const spinner = document.querySelector('.group .tw-border-cyber-neon\\/40');
                if(spinner) spinner.style.animationDuration = '0.5s';
                // Demo autofill
                setTimeout(() => { handlePin('1');handlePin('1');handlePin('1');handlePin('1'); }, 800);
            },

            openAddModal: (type) => {
                document.getElementById('entry-form').reset();
                app.clearImage();
                document.getElementById('entry-id').value = '';
                document.getElementById('entry-type').value = type;
                
                if (type === 'status') {
                    document.getElementById('dialog-title').innerText = "New Flux";
                    document.getElementById('dialog-subtitle').innerText = "Vanishes in 24h";
                    document.getElementById('memory-fields').classList.add('tw-hidden');
                } else {
                    document.getElementById('dialog-title').innerText = "New Entry";
                    document.getElementById('dialog-subtitle').innerText = "Shared with everyone";
                    document.getElementById('memory-fields').classList.remove('tw-hidden');
                    // Set defaults
                    const now = new Date();
                    document.querySelector('[name=date]').value = now.toISOString().split('T')[0];
                    document.querySelector('[name=time]').value = now.toTimeString().slice(0,5);
                }
                els.dialog.showModal();
            },

            closeDialog: () => els.dialog.close(),

            saveEntry: async () => {
                const form = document.getElementById('entry-form');
                const formData = new FormData(form);
                const type = document.getElementById('entry-type').value;
                const now = Date.now();

                const data = {
                    type: type,
                    author: state.currentUser.name,
                    createdAt: now,
                    imageData: document.getElementById('inp-image').value
                };

                if (type === 'memory') {
                    data.title = formData.get('title');
                    if(!data.title) return showToast("Title required", "error");
                    data.date = formData.get('date');
                    data.time = formData.get('time');
                    data.category = formData.get('category');
                    data.mood = parseInt(formData.get('mood'));
                    data.notes = document.getElementById('inp-notes').value;
                    data.comments = [];
                } else {
                    // Status
                    if(!data.imageData) return showToast("Image required for Flux", "error");
                    data.expiresAt = now + (24 * 60 * 60 * 1000); // 24h expiry
                }

                try {
                    if(db) {
                        const col = getSharedCollection();
                        await addDoc(col, data);
                    } else {
                        // Local fallback logic
                        const current = JSON.parse(localStorage.getItem('dk_shared_v1') || '[]');
                        data.id = 'loc_' + now;
                        current.unshift(data);
                        localStorage.setItem('dk_shared_v1', JSON.stringify(current));
                        initData(); // Reload
                    }
                    app.closeDialog();
                    showToast(type === 'status' ? "Flux Posted" : "Memory Crystallized");
                } catch(e) {
                    console.error(e);
                    showToast("Error Saving", "error");
                }
            },

            addComment: async (id, text) => {
                if(!text.trim()) return;
                const newComment = {
                    author: state.currentUser.name,
                    text: text.trim(),
                    timestamp: Date.now()
                };

                if(db) {
                    const docRef = doc(getSharedCollection(), id);
                    // We need to fetch the doc first to append (simplest without arrayUnion import)
                    // But arrayUnion is better if imported. I'll rely on reading current state locally for now to keep it simple or full fetch
                    // Let's assume we read from state since we have real-time listener
                    const item = state.data.find(d => d.id === id);
                    if(item) {
                        const updatedComments = [...(item.comments || []), newComment];
                        await updateDoc(docRef, { comments: updatedComments });
                    }
                } else {
                    const raw = JSON.parse(localStorage.getItem('dk_shared_v1') || '[]');
                    const idx = raw.findIndex(d => d.id === id);
                    if(idx > -1) {
                        if(!raw[idx].comments) raw[idx].comments = [];
                        raw[idx].comments.push(newComment);
                        localStorage.setItem('dk_shared_v1', JSON.stringify(raw));
                        initData();
                    }
                }
                showToast("Comment added");
            },

            deleteEntry: async (id) => {
                if(!confirm("Shatter this memory forever?")) return;
                if(db) {
                    await deleteDoc(doc(getSharedCollection(), id));
                } else {
                    const raw = JSON.parse(localStorage.getItem('dk_shared_v1') || '[]');
                    const filtered = raw.filter(d => d.id !== id);
                    localStorage.setItem('dk_shared_v1', JSON.stringify(filtered));
                    initData();
                }
                showToast("Memory Shattered");
            },

            viewStatus: (status) => {
                if(status.imageData) app.lightbox(status.imageData);
            },

            lightbox: (src) => {
                els.lightboxImg.src = src;
                els.lightbox.classList.remove('tw-opacity-0', 'tw-pointer-events-none');
                setTimeout(() => els.lightboxImg.classList.remove('tw-scale-90'), 10);
                setTimeout(() => els.lightboxImg.classList.add('tw-scale-100'), 10);
            },

            closeLightbox: () => {
                els.lightbox.classList.add('tw-opacity-0', 'tw-pointer-events-none');
                els.lightboxImg.classList.add('tw-scale-90');
                els.lightboxImg.classList.remove('tw-scale-100');
            },

            downloadImage: (url) => {
                // If url isn't provided, grab from lightbox
                const src = url || els.lightboxImg.src;
                const a = document.createElement('a');
                a.href = src;
                a.download = `datekeep_memory_${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showToast("Saving to device...");
            },

            filter: (cat, btn) => {
                state.filter = state.filter === cat ? 'all' : cat;
                if(btn) {
                    document.querySelectorAll('.active-filter').forEach(b => {
                        b.classList.remove('active-filter', 'tw-bg-white/10', 'tw-border-white/20');
                        b.classList.add('tw-text-gray-400');
                    });
                    if(state.filter !== 'all') {
                        btn.classList.add('active-filter', 'tw-bg-white/10', 'tw-border-white/20');
                        btn.classList.remove('tw-text-gray-400');
                    }
                }
                renderTimeline();
            },

            clearImage: (e) => {
                if(e) e.stopPropagation();
                document.getElementById('img-input').value = '';
                document.getElementById('inp-image').value = '';
                document.getElementById('img-preview-box').classList.add('tw-hidden');
                document.getElementById('upload-placeholder').classList.remove('tw-hidden');
            },

            updateMood: (val) => {
                document.getElementById('mood-val').innerText = state.moods[val-1];
                document.getElementById('mood-val').style.color = getMoodColor(val);
            },

            toggleSound: () => {
                state.soundOn = !state.soundOn;
                const btn = document.getElementById('sound-btn');
                if(state.soundOn) {
                    btn.classList.add('tw-text-cyber-neon', 'tw-bg-cyber-neon/20');
                    showToast("Zen Mode: Active");
                } else {
                    btn.classList.remove('tw-text-cyber-neon', 'tw-bg-cyber-neon/20');
                    showToast("Zen Mode: Off");
                }
            },

            signOut: () => location.reload()
        };

        // IMAGE HANDLER
        document.getElementById('img-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    document.getElementById('inp-image').value = evt.target.result;
                    document.getElementById('img-preview').src = evt.target.result;
                    document.getElementById('img-preview-box').classList.remove('tw-hidden');
                    document.getElementById('upload-placeholder').classList.add('tw-hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // DEBOUNCE
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
        els.searchInput.addEventListener('input', debounce(() => renderTimeline(), 300));

        // RIPPLE
        window.createRipple = (e) => {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            const size = 20;
            ripple.style.width = ripple.style.height = `${size}px`;
            ripple.style.left = `${e.clientX - size/2}px`;
            ripple.style.top = `${e.clientY - size/2}px`;
            document.body.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
        };

        function getMoodColor(val) { return ['#ef4444', '#f97316', '#eab308', '#22c55e', '#a855f7'][val-1] || '#a855f7'; }

        function showToast(msg, type='info') {
            const t = document.createElement('div');
            const borderColor = type === 'error' ? 'tw-border-red-500' : 'tw-border-cyber-neon';
            t.className = `liquid-card tw-px-4 tw-py-3 tw-rounded-2xl tw-border-l-4 ${borderColor} tw-flex tw-items-center tw-gap-3 slide-in-toast`;
            t.innerHTML = `<i data-lucide="${type==='error'?'alert-circle':'check-circle'}" class="tw-w-5 tw-h-5 tw-text-white"></i> <span class="tw-font-bold tw-text-sm">${msg}</span>`;
            document.getElementById('toast-container').appendChild(t);
            lucide.createIcons();
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>